{% extends "pyduck/base.html.jinja" %}


{% block main %}
{% set c = sidebar_community | selectattr("code", "eq", "help") | list | first %}
<div class="container">
    <div class="bg-primary-subtle rounded-2 mt-3 p-3">
        <div class="fs-4 fw-bold">
            {{ c.emoji }}
            <span class="text-primary-emphasis">{{ c.name }}</span>
        </div>
        <div class="pt-2">
            {{ c.description }}
        </div>
    </div>
    <div class="mt-3">
        <div class="text-end">
            {% if current_user.is_authenticated %}
            <a class="btn btn-primary rounded-0" href="{{ url_for('pyduck.community.question_new') }}">질문하기</a>
            {% else %}
            <a class="btn btn-primary rounded-0" hx-get="{{ url_for('pyduck.community.question_new') }}"
               hx-swap="none">질문하기</a>
            {% endif %}
        </div>
    </div>
</div>
<div class="container">
    <div class="p-3 bg-body-tertiary rounded-2 mt-3">
        {% for q in qp %}
        <div class="row py-3 border-bottom">
            <div class="col d-flex justify-content-between">
                <div class="d-flex align-items-center">
                    <div class="bg-body-secondary rounded-1 d-flex justify-content-center align-items-center"
                         style="width: 48px; height: 48px;">
                        <span class="fs-5">{{ c.emoji }}</span>
                    </div>
                    <div class="ps-1 ps-lg-3">
                        <div class="fw-bold fs-5">
                            <a class="link link-body-emphasis"
                               href="{{ url_for('pyduck.community.question', question_id=q.id) }}">
                                {{ q.title }}
                            </a>
                        </div>
                        <div>
                            <small>
                                {{ q.user.nickname }}님이
                                <pd-relative-time datetime="{{ q.created_at }}"></pd-relative-time>
                                {{ c.name }} 관련 작성
                            </small>
                        </div>
                    </div>
                </div>
                <div class="d-flex align-items-center gap-2">
                    <div class="pe-3">
                        <img src="{{ q.user.avatar.url }}" width="30px" height="30px" class="rounded-circle">
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-arrow-up"></i>
                        <span class="ps-1 pe-2">{{ q.vote_count }}</span>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="bi bi-chat"></i>
                        <span class="ps-1 pe-2">{{ q.comment_count }}</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- [start] infinite scroll -->
        {% if loop.last and qp.has_next %}
        <div
             hx-get="{{ url_for('pyduck.community.questions', page=qp.next_num) }}"
             hx-trigger="revealed"
             hx-swapp="afterend">
        </div>
        {% endif %}
        <!-- infinite scroll [end] -->
        {% endfor %}
    </div>
</div>
{% endblock %}